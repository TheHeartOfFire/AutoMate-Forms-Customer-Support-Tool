<Page
    x:Class="AMFormsCST.Desktop.Views.Pages.Tools.FormgenUtilitiesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:AMFormsCST.Desktop.Controls"
    xmlns:converters="clr-namespace:AMFormsCST.Desktop.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:AMFormsCST.Desktop.Views.Pages.Tools"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:AMFormsCST.Desktop.ViewModels.Pages.Tools.FormgenUtils"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:viewModels="clr-namespace:AMFormsCST.Desktop.ViewModels.Pages.Tools"
    d:DataContext="{d:DesignInstance Type=viewModels:FormgenUtilitiesViewModel,
                                     IsDesignTimeCreatable=False}"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:BooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" Invert="True" />
        <converters:NullableBoolToSymbolConverter x:Key="NullableBoolToSymbolConverter" />
        <converters:NullableBoolToTextConverter x:Key="NullableBoolToTextConverter" />
    </Page.Resources>

    <Grid Margin="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" MinWidth="250" MaxWidth="500" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Left Panel: File Operations and TreeView  -->
        <Grid Grid.Column="0" Margin="0,0,12,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Vertical">
                <ui:Button
                    Appearance="Primary"
                    Command="{Binding OpenFormgenFileCommand}"
                    Content="Open .formgen file"
                    Icon="{ui:SymbolIcon Document24}" />
                <ui:Button
                    Margin="0,8,0,0"
                    Appearance="Success"
                    Command="{Binding SaveFormgenFileCommand}"
                    Content="Save Changes"
                    Icon="{ui:SymbolIcon Save24}"
                    IsEnabled="{Binding IsFileLoaded}" />
            </StackPanel>

            <Border
                Grid.Row="1"
                Margin="0,12,0,0"
                Padding="8"
                Background="{ui:ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ui:ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="4">
                <Grid>
                    <ui:ProgressRing
                        IsIndeterminate="True"
                        Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <TreeView
                        ItemsSource="{Binding TreeViewNodes}"
                        Visibility="{Binding IsFileLoaded, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="{x:Type TreeViewItem}">
                                <Setter Property="IsExpanded" Value="True" />
                                <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                                <Setter Property="Padding" Value="2" />
                            </Style>
                        </TreeView.ItemContainerStyle>
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate DataType="{x:Type models:TreeItemNodeViewModel}" ItemsSource="{Binding Children}">
                                <TextBlock Text="{Binding Name}" />
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>

                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Text="Load a .formgen file to begin"
                        Visibility="{Binding IsFileLoaded, Converter={StaticResource InverseBooleanToVisibilityConverter}}" />
                </Grid>
            </Border>
        </Grid>

        <!--  Right Panel: Properties  -->
        <Grid Grid.Column="1" IsEnabled="{Binding IsFileLoaded}">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Orientation="Vertical">
                    <ui:CardControl Header="Form Details">
                        <StackPanel Orientation="Vertical">
                            <TextBlock Text="Form Title" />
                            <ui:TextBox Margin="0,4,0,0" Text="{Binding FormTitle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                            <TextBlock Margin="0,12,0,0" Text="Form UUID" />
                            <Grid Margin="0,4,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBox Grid.Column="0" IsReadOnly="True" Text="{Binding Uuid}" />
                                <ui:Button
                                    Grid.Column="1"
                                    Margin="8,0,0,0"
                                    Appearance="Secondary"
                                    Command="{Binding RegenerateUuidCommand}"
                                    Content="Regenerate"
                                    Icon="{ui:SymbolIcon ArrowSync24}" />
                            </Grid>
                        </StackPanel>
                    </ui:CardControl>

                    <ui:CardControl Margin="0,12,0,0" Header="Image Options">
                        <StackPanel Orientation="Vertical">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <ui:SymbolIcon
                                    Grid.Column="0"
                                    FontSize="16"
                                    Symbol="{Binding IsImageFound, Converter={StaticResource NullableBoolToSymbolConverter}}" />
                                <TextBlock
                                    Grid.Column="1"
                                    Margin="8,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="{Binding IsImageFound, Converter={StaticResource NullableBoolToTextConverter}}" />
                            </Grid>

                            <ui:ToggleSwitch
                                Margin="0,8,0,0"
                                Content="Rename associated image on save"
                                IsChecked="{Binding ShouldRenameImage, Mode=TwoWay}"
                                IsEnabled="{Binding IsImageFound, Converter={StaticResource BooleanToVisibilityConverter}}"
                                OffContent="No"
                                OnContent="Yes" />
                        </StackPanel>
                    </ui:CardControl>

                    <ContentControl
                        Margin="0,12,0,0"
                        Content="{Binding SelectedNodeProperties}" />

                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Grid>
</Page>
