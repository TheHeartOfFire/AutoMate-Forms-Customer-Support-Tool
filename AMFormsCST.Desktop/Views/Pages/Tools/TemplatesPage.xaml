<Page x:Class="AMFormsCST.Desktop.Views.Pages.Tools.TemplatesPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:AMFormsCST.Desktop.Views.Pages.Tools"
      xmlns:coreInterfaces="clr-namespace:AMFormsCST.Core.Interfaces.BestPractices;assembly=AMFormsCST.Core"
      xmlns:viewModels="clr-namespace:AMFormsCST.Desktop.ViewModels.Pages.Tools"
      xmlns:templateViewModels="clr-namespace:AMFormsCST.Desktop.ViewModels.Pages.Tools.Templates"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml" 
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="TemplatesPage"
      d:DataContext="{d:DesignInstance viewModels:TemplatesViewModel, 
                                       IsDesignTimeCreatable=False}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Use ListBox for selection logic -->
        <ListBox Grid.Column="0"
                 ItemsSource="{Binding Templates}"
                 SelectedItem="{Binding SelectedTemplate, Mode=TwoWay}">
            <ListBox.ItemTemplate>
                <DataTemplate DataType="{x:Type templateViewModels:TemplateItemViewModel}">
                    <StackPanel Margin="5">
                        <TextBlock Text="{Binding Template.Name, Mode=OneWay}" FontWeight="Bold" FontSize="16"/>
                        <TextBlock Text="{Binding Template.Description, Mode=OneWay}" TextWrapping="Wrap"/>
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <WrapPanel Grid.Column="1" Orientation="Vertical">
            <Label Content="{Binding SelectedTemplate.Template.Name}" HorizontalAlignment="Center"/>
            <Label Content="{Binding SelectedTemplate.Template.Description}" HorizontalAlignment="Center"/>
            <Label Content="{Binding SelectedTemplate.Template.Type}" HorizontalAlignment="Center"/>
            <ui:TextBox Text="{Binding SelectedTemplate.Output, Mode=OneWay}" TextWrapping="Wrap" Margin="10" IsReadOnly="True" IsReadOnlyCaretVisible="True"/>
            <ItemsControl ItemsSource="{Binding SelectedTemplate.Variables}" HorizontalAlignment="Left">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type templateViewModels:TemplateVariableViewModel}">
                        <ui:TextBox Margin="10,0,0,5" 
                                  Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                  PlaceholderText="{Binding DefaultValue}" 
                                  HorizontalAlignment="Stretch"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
            <Border Background="#1AFFFFFF" BorderBrush="LightGray" BorderThickness="1" Margin="0,5,10,0" CornerRadius="5" HorizontalAlignment="Right">

                <WrapPanel Orientation="Horizontal">
                    <ui:Button
                          Command="{Binding CopyTemplateCommand}"
                          Margin="5"
                          Padding="10,5"
                          HorizontalAlignment="Left">
                        <ui:SymbolIcon Symbol="Copy24"/>
                    </ui:Button>
                    <ui:Button
                          Command="{Binding AddTemplateCommand}"
                          Margin="5"
                          Padding="10,5"
                          HorizontalAlignment="Left">
                        <ui:SymbolIcon Symbol="Add24"/>
                    </ui:Button>
                    <ui:Button
                          Command="{Binding EditTemplateCommand}"
                          Margin="5"
                          Padding="10,5"
                          HorizontalAlignment="Left">
                        <ui:SymbolIcon Symbol="Edit24"/>
                    </ui:Button>
                    <ui:Button
                          Command="{Binding RemoveTemplateCommand}"
                          Margin="5"
                          Padding="10,5"
                          HorizontalAlignment="Left">
                        <ui:SymbolIcon Symbol="Delete24"/>
                    </ui:Button>
                    <ui:Button
                          Command="{Binding ImportTemplateCommand}"
                          Margin="5"
                          Padding="10,5"
                          HorizontalAlignment="Left">
                        <ui:SymbolIcon Symbol="ArrowDownload24"/>
                    </ui:Button>
                </WrapPanel>
            </Border>
        </WrapPanel>
    </Grid>
</Page>
